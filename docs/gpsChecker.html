<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VarAC Wednesday - GPS Checker</title>
    <link rel="stylesheet" href="assets/css/varACWed-style.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png">
    <link rel="manifest" href="/assets/images/site.webmanifest">

    <!--- CSS Styles for t his page -->
    <style>

      body {
      font-family: Arial, sans-serif;
      padding: 20px;
      }
        .criteria {
          margin-top: 20px;
          display: none;
        }
        .criteria h3 {
          margin-bottom: 5px;
        }
        .criteria ul {
          list-style: none;
          padding-left: 0;
        }
        .criteria li::before {
          content: "‚ùå";
          margin-right: 10px;
          color: red;
        }
        .criteria li.checked::before {
          content: "‚úî";
          color: green;
        }
        #map {
          margin-top: 30px;
          width: 100%;
          height: 400px;
          border: 1px solid #ccc;
        }

        table {
          width: 100%;
          border-collapse: collapse;
        }
        td {
          width: 50%;
          border: 1px solid #ccc;
          padding: 10px;
          text-align: center;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  </head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-8B54HBJ66J"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-8B54HBJ66J');
  </script>

  <body>
    <header>
      <img src="/assets/images/VarACWednesdayLogo-White.png" alt="VarAC Wednesday" width="300" height="auto" />
      <p>Promoting digital comms excellence for all VarAC enthusiasts</p>
    </header>

    <div id="nav-placeholder"></div>
    <script>
      fetch('/navbar.html')
        .then(res => res.text())
        .then(data => {
                document.getElementById('nav-placeholder').innerHTML = data;
              });
    </script>


    <main>
      <h1>GPS Coordinate Format Checker</h1>
      <label for="gpsInput">GPS Coordinate:</label>
      <input type="text" id="gpsInput" placeholder='e.g. 48.129356, 14.940682'>
      <button onclick="checkFormat()">CHECK FORMAT</button>
      </br></br>
      <div id="output">
        <table>
          <tr>
            <td>
              <div class="criteria" id="results">
                <h3>Latitude Checks</h3>
                <ul id="latCriteria">
                  <li id="latDegrees">Degrees provided</li>
                  <li id="latDegree">Degree symbol provided</li>
                  <li id="latSpace">Space between degree symbol and seconds</li>
                  <li id="latMinutes">Minutes provided</li>
                  <li id="latHemisphere">Hemisphere provided</li>
                  <li id="latRange">Latitude in valid range (0 to 90)</li>
                </ul>
                <h3>Longitude Checks</h3>
                <ul id="lonCriteria">
                  <li id="lonDegrees">Degrees provided</li>
                  <li id="lonDegree">Degree symbol provided</li>
                  <li id="lonSpace">Space between degree symbol and seconds</li>
                  <li id="lonMinutes">Minutes provided</li>
                  <li id="lonHemisphere">Hemisphere provided</li>
                  <li id="lonRange">Longitude in valid range (0 to 180)</li>
                </ul>
                <h3>Delimiter Check</h3>
                <ul>
                  <li id="delimiter">Space delimiter between Latitude and Longitude</li>
                </ul>
              </div>
            </td>
            <td>
              <div id="map"></div>
            </td>
        </table>
      </div>

      <script>
        function checkFormat() {
                  const input = document.getElementById("gpsInput").value.trim();
                  const delimiter = /[NS]\s+(\d+)¬∞/;
                  const gpsDel = /(\d+)¬∞(?:\s+)?(\d+\.\d+)(?:\s)?[NS](?:\s)?(\d+)¬∞(?:\s+)?(\d+.\d+)(?:\s)?[E|W]/;
                  const match = input.match(gpsDel);

                  lat=0;
                  lon=0;
                  if (match) {
                            console.log("Matched GPS extraction");
                            lat = parseFloat(match[1])+parseFloat(match[2])/60; // Group 1: degrees
                            lon = parseFloat(match[3])+parseFloat(match[4])/60; // Group 2: decimal minutes
                            console.log("Latitude degrees:", lat);
                            console.log("Latitude decimal minutes:", lon);
                          } else {
                                    console.log("Input does not match expected format.");
                                  }


                  const parts = input.match(delimiter);

                  // Show criteria section
                  const resultsDiv = document.getElementById("results");
                  resultsDiv.style.display = "block";

                  // Reset all checklist items
                  const allChecks = resultsDiv.querySelectorAll("li");
                  allChecks.forEach(item => item.classList.remove("checked"));

                  // Basic numeric check
                  toggleCheck("latDegrees", !isNaN(lat));
                  toggleCheck("lonDegrees", !isNaN(lon));

                  // Format checks (for illustrative purposes)
                  const degreeSymbol = /¬∞/;
                  const spaceBetween = /(\d+¬∞)\s+(\d+)/;
                  const LatminutesProvided = /(\d+.\d+)(?:\s+)?[NS]/;
                  const LonminutesProvided = /(\d+.\d+)(?:\s+)?[EW]/;
                  const hemisphereLat = /[NS]/;
                  const hemisphereLon = /[EW]/;

                  toggleCheck("latDegree", degreeSymbol.test(input));
                  toggleCheck("latSpace", spaceBetween.test(input));
                  toggleCheck("latMinutes", LatminutesProvided.test(input));
                  toggleCheck("latHemisphere", hemisphereLat.test(input));

                  toggleCheck("lonDegree", degreeSymbol.test(input));
                  toggleCheck("lonSpace", spaceBetween.test(input));
                  toggleCheck("lonMinutes", LonminutesProvided.test(input));
                  toggleCheck("lonHemisphere", hemisphereLon.test(input));

                  toggleCheck("delimiter", parts);

                  // Range checks
                  toggleCheck("latRange", !isNaN(lat) && lat >= -90 && lat <= 90);
                  toggleCheck("lonRange", !isNaN(lon) && lon >= -180 && lon <= 180);

                  // Plot on map
                  const mapDiv = document.getElementById("map");
                  mapDiv.innerHTML = ""; // üîÑ Clear previous map
                  if (!isNaN(lat) && !isNaN(lon)) {
                            const mapFrame = document.createElement("iframe");
                            mapFrame.width = "100%";
                            mapFrame.height = "400";
                            mapFrame.style.border = "0";
                            mapFrame.loading = "lazy";
                            mapFrame.allowFullscreen = true;
                            mapFrame.referrerPolicy = "no-referrer-when-downgrade";
                            mapFrame.src = `https://www.google.com/maps?q=${lat},${lon}&output=embed`;
                            mapDiv.appendChild(mapFrame);
                          }
                }


        function toggleCheck(id, condition) {
                  const element = document.getElementById(id);
                  if (condition) {
                            element.classList.add("checked");
                          } else {
                                    element.classList.remove("checked");
                                  }
                }


      </script>




    </main>

    <div id="footer-placeholder"></div>
    <script>
      fetch('footer.html')
        .then(res => res.text())
        .then(data => {
                document.getElementById('footer-placeholder').innerHTML = data;
              });

      document.addEventListener('DOMContentLoaded', function () {

              // Select all links with class 'new-tab'
              document.querySelectorAll('a.new-tab').forEach(function(link) {
                      link.addEventListener('click', function (e) {
                              e.preventDefault();
                              window.open(link.href, '_blank');
                            });
                    });
            });

    </script>

  </body>
</html>

