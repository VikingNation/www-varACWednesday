<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VarAC Wednesday - Home</title>
    <link rel="stylesheet" href="assets/css/varACWed-style.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png">
    <link rel="manifest" href="/assets/images/site.webmanifest">
    <script type="text/javascript" src="/assets/js/klaroConfig.js"></script>
    <script defer type="text/javascript" src="https://cdn.kiprotect.com/klaro/latest/klaro.js"></script>

  <!-- Klaro will only activate this if the user consents to "google-analytics" -->
  <script type="text/plain" data-type="application/javascript" data-name="google-analytics" async src="https://www.googletagmanager.com/gtag/js?id=G-8B54HBJ66J"></script>

  <script type="text/plain" data-type="application/javascript" data-name="google-analytics">
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-8B54HBJ66J', {
          'allow_google_signals': false,   // disables Google signals 
          'allow_ad_personalization_signals': false
        });
  </script>
  </head>
  <body>
    <header>
      <img src="/assets/images/VarACWednesdayLogo-White.png" alt="VarAC Wednesday" width="300" height="auto" />
      <p>Promoting digital comms excellence for all VarAC enthusiasts</p>
    </header>

    <div id="nav-placeholder"></div>
    <script>
      fetch('/navbar.html')
        .then(res => res.text())
        .then(data => {
                document.getElementById('nav-placeholder').innerHTML = data;
              });
    </script>


    <main>
      <h2>Welcome to VarAC Wednesday!</h2>
      <p>The weekly digital ham radio net using VarAC. Explore training resources, last week's stats and map, and learn more about operating VarAC with confidence. Check out our <a href="news.html">News page</a> for important announcements.</br></br></p>

      <h2>Join our next net!</h2>
      <div id="netdate-placeholder" align="center"></div>

      <p>See <a href="about.html#instructions">VarAC Wednesday Instructions</a> for directions on how to send messages this week.</p>

    </main>

    <div id="footer-placeholder"></div>

    <script>
      fetch('footer.html')
        .then(res => res.text())
        .then(data => {
                document.getElementById('footer-placeholder').innerHTML = data;
              });

      document.addEventListener('DOMContentLoaded', function () {

              // Select all links with class 'new-tab'
              document.querySelectorAll('a.new-tab').forEach(function(link) {
                      link.addEventListener('click', function (e) {
                              e.preventDefault();
                              window.open(link.href, '_blank');
                            });
                    });
            });

      function getNextWednesday(date = new Date()) {
              const currentDay = date.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday

              if (currentDay === 3) {
                      return date;
                    } else {

                            const daysUntilWednesday = (3 - currentDay + 7) % 7 || 7;
                            const nextWednesday = new Date(date);
                            nextWednesday.setDate(date.getDate() + daysUntilWednesday);
                            console.log(nextWednesday);
                            return nextWednesday;
                          }
            }

      function getOrdinalWednesday(date) {
                if (date.getDay() !== 3) {
                            throw new Error("Provided date is not a Wednesday.");
                          }

                const year = date.getFullYear();
                const month = date.getMonth();

                // Start from the 1st of the month and find all Wednesdays
                const wednesdays = [];
                for (let day = 1; day <= 31; day++) {
                            const d = new Date(year, month, day);
                            if (d.getMonth() !== month) break; // Exit if month changed
                            if (d.getDay() === 3) wednesdays.push(d);
                          }

                // Find the index of the input Wednesday
                const index = wednesdays.findIndex(d => d.getDate() === date.getDate());

                if (index === -1) return null;

                const ordinals = [1, 2, 3, 4, 5];
                return ordinals[index];
            }

      const nextWednesday = getNextWednesday();
      const weekInMonth = getOrdinalWednesday(nextWednesday);
      messageRequested = "";
      if (weekInMonth == 1) {
              messageRequested = "This is the first week of the month. A standard check-in is requested with the option of including a weather report.";
            }
      else if (weekInMonth == 3) { 
              messageRequested = "This is the third week of the month.  A standard check-in is requested with the option of also checking-in via optional ICS-213 message.";
            } else {
                    messageRequested = "Please send a standard check-in message this week.";
                  }
      
      document.getElementById('netdate-placeholder').innerHTML = `<p>Join our next net on ${nextWednesday.toDateString()}. ${messageRequested}</p>`;

    </script>
  </body>
</html>

