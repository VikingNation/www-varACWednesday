<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: 'Segoe UI', sans-serif; padding: 40px; text-align: center; background-color: #f8f9fa; }
      .container { max-width: 500px; margin: 0 auto; border: 1px solid #ddd; padding: 30px; border-radius: 12px; background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
      h3 { color: #1a73e8; margin-bottom: 25px; }
      .input-group { margin-bottom: 15px; text-align: left; }
      label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
      input[type="text"], select { width: 100%; padding: 12px; border: 2px solid #dfe1e5; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
      button { background-color: #1a73e8; color: white; border: none; padding: 14px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; width: 100%; margin-top: 10px; }
      button:disabled { background-color: #ccc; }
      #statusArea { margin-top: 30px; text-align: left; border-top: 1px solid #eee; padding-top: 20px; display: none; }
      .step { margin: 12px 0; display: flex; align-items: center; font-size: 15px; }
      .check { color: #188038; font-weight: bold; margin-right: 12px; }
      .loader { border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; width: 18px; height: 18px; animation: spin 1s linear infinite; margin-right: 12px; }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
      .error-msg { color: #d93025; background: #fce8e6; padding: 15px; border-radius: 8px; margin-top: 10px; }
      .download-link { display: block; margin-top: 15px; padding: 12px; background: #188038; color: white; text-decoration: none; border-radius: 8px; text-align: center; font-weight: bold; }
    </style>
  </head>
  <body>
    <div class="container">
      <h3>VarAC Wednesday Award Download Portal</h3>
      <form id="awardForm">
        <div class="input-group">
          <label>Please enter the callsign:</label>
          <input type="text" id="callsign" placeholder="e.g. W1AW" required>
        </div>
        
        <div class="input-group">
          <label>Select Award:</label>
          <select id="awardName" required>
            <option value="" disabled selected>-- Choose an Award --</option>
            <? awardNames.forEach(name => { ?>
              <option value="<?= name ?>"><?= name ?></option>
            <? }); ?>
          </select>
        </div>
        
        <button type="submit" id="submitBtn">Generate Award</button>
      </form>

      <div id="statusArea">
        <div id="step1" class="step"></div>
        <div id="step2" class="step"></div>
        <div id="step3" class="step"></div>
      </div>
    </div>

    <script>
      document.getElementById('awardForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const callsign = document.getElementById('callsign').value.toUpperCase().trim();
        const awardName = document.getElementById('awardName').value;
        const s1 = document.getElementById('step1');
        const s2 = document.getElementById('step2');
        const s3 = document.getElementById('step3');
        const btn = document.getElementById('submitBtn');

        document.getElementById('statusArea').style.display = 'block';
        btn.disabled = true;
        s1.innerHTML = '<div class="loader"></div> Verifying eligibility...';
        s2.innerHTML = ''; s3.innerHTML = '';

        google.script.run.withSuccessHandler(function(vRes) {
          if (vRes.success) {
            s1.innerHTML = '<span class="check">✓</span> <span style="color:#188038">Verified eligible for ' + awardName + '.</span>';
            s2.innerHTML = '<div class="loader"></div> Generating your award PDF...';
            
            google.script.run.withSuccessHandler(function(gRes) {
              if (gRes.success) {
                s2.innerHTML = '<span class="check">✓</span> <span style="color:#188038">PDF Generated successfully. </span>';
                s3.innerHTML = '<span style="font-weight:bold; color:#1a73e8; display:block; text-align:center; margin-top:10px;">Done!</span><br/><a href="' + gRes.downloadUrl + '" class="download-link" target="_blank">Download Your Award PDF</a>';
              } else {
                s2.innerHTML = '<div class="error-msg">' + gRes.message + '</div>';
              }
              btn.disabled = false;
            }).generateAward(callsign, awardName);
          } else {
            s1.innerHTML = '';
            s3.innerHTML = '<div class="error-msg">' + vRes.message + '</div>';
            btn.disabled = false;
          }
        }).verifyCallsign(callsign, awardName);
      });
    </script>
  </body>
</html>
